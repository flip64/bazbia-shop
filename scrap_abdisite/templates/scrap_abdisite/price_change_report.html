{% extends 'scrap_abdisite/base.html' %}
{% load humanize %}
{% block content %}
<div class="container mt-4">
  <h2 class="mb-3">📈 گزارش تغییرات قیمت (تاریخ شمسی)</h2>

  <form method="get" class="row g-3 mb-4">
    <div class="col-md-3">
      <label>از تاریخ:</label>
      <input id="start" name="start" class="form-control" value="{{ j_start }}" autocomplete="off" />
    </div>
    <div class="col-md-3">
      <label>تا تاریخ:</label>
      <input id="end" name="end" class="form-control" value="{{ j_end }}" autocomplete="off" />
    </div>
    <div class="col-md-4 align-self-end">
      <div class="btn-group w-100">
        <button name="range" value="week" class="btn btn-outline-primary {% if range_option == 'week' %}active{% endif %}">هفته اخیر</button>
        <button name="range" value="month" class="btn btn-outline-primary {% if range_option == 'month' %}active{% endif %}">ماه اخیر</button>
        <button name="range" value="year" class="btn btn-outline-primary {% if range_option == 'year' %}active{% endif %}">سال اخیر</button>
      </div>
    </div>
    <div class="col-md-2 align-self-end">
      <button class="btn btn-primary w-100">نمایش</button>
    </div>
  </form>

  {% if report_data %}
  <table class="table table-striped table-bordered text-center align-middle">
    <thead>
      <tr>
        <th>محصول</th>
        <th>تأمین‌کننده</th>
        <th>قیمت قبلی</th>
        <th>قیمت جدید</th>
        <th>تغییر</th>
        <th>درصد تغییر</th>
        <th>آخرین بررسی (شمسی)</th>
      </tr>
    </thead>
    <tbody>
      {% for item in report_data %}
      <tr>
        <td>{{ item.product }}</td>
        <td>{{ item.supplier }}</td>
        <td>{{ item.old_price|intcomma }} تومان</td>
        <td>{{ item.new_price|intcomma }} تومان</td>
        <td>
          {% if item.change > 0 %}
            <span class="text-success">+{{ item.change|intcomma }}</span>
          {% elif item.change < 0 %}
            <span class="text-danger">{{ item.change|intcomma }}</span>
          {% else %}
            بدون تغییر
          {% endif %}
        </td>
        <td>{{ item.percent }}٪</td>
        <td>{{ item.last_checked }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="mt-3 text-muted">در این بازه هیچ محصولی تغییر قیمت نداشته است.</p>
  {% endif %}
</div>

<!-- 📅 Persian Date Picker -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/css/persian-datepicker.min.css" />
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/persian-date/dist/persian-date.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/persian-datepicker/dist/js/persian-datepicker.min.js"></script>
<script>
  $(function(){
    $("#start").persianDatepicker({ format: "YYYY-MM-DD", initialValue: false });
    $("#end").persianDatepicker({ format: "YYYY-MM-DD", initialValue: false });
  });
</script>
{% endblock %}
